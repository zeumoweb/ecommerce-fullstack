<!DOCTYPE html>
<html lang="zxx">

<head>
    <meta charset="UTF-8">
    <meta name="description" content="Male_Fashion Template">
    <meta name="keywords" content="Male_Fashion, unica, creative, html">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Male-Fashion</title>

    <!-- Google Font -->
    <link href="https://fonts.googleapis.com/css2?family=Nunito+Sans:wght@300;400;600;700;800;900&display=swap"
        rel="stylesheet">

    <!-- Css Styles -->
    <link rel="stylesheet" href="css/bootstrap.min.css" type="text/css">
    <link rel="stylesheet" href="css/font-awesome.min.css" type="text/css">
    <link rel="stylesheet" href="css/elegant-icons.css" type="text/css">
    <link rel="stylesheet" href="css/magnific-popup.css" type="text/css">
    <link rel="stylesheet" href="css/nice-select.css" type="text/css">
    <link rel="stylesheet" href="css/owl.carousel.min.css" type="text/css">
    <link rel="stylesheet" href="css/slicknav.min.css" type="text/css">
    <link rel="stylesheet" href="css/style.css" type="text/css">
</head>

<body>
    <!-- Page Preloder -->
    <div id="preloder">
        <div class="loader"></div>
    </div>


    <div class="container">
        <div class="row">
            <div class="col-lg-3 col-md-3">
                <div class="header__logo">
                    <a href="index.html">
                        <img src="img/logo.png" alt="" style="width: 50%; height: auto;">
                    </a>
                </div>
            </div>
            <div class="col-lg-6 col-md-6">
                <nav class="header__menu mobile-menu">
                    <ul>
                        <li><a href="./index.html">Home</a></li>
                        <li class="active"><a href="./shop.html">Shop</a></li>
                        <li><a href="./chat.html">Chat</a></li>
                        <li><a href="#">Pages</a>
                            <ul class="dropdown">
                                <li><a href="./shop-details.html">Shop Details</a></li>
                                <li><a href="./shopping-cart.html">Shopping Cart</a></li>
                                <li><a href="./checkout.html">Check Out</a></li>
                            </ul>
                        </li>

                        <li><a id="login" href="./login.html">Login</a></li>
                    </ul>
                </nav>
            </div>
            <div class="col-lg-3 col-md-3">
                <div class="header__nav__option">
                    <a href="#" class="search-switch"><img src="img/icon/search.png" alt=""></a>
                    <a href="./shopping-cart.html"><img src="img/icon/heart.png" alt=""></a>
                    <a href="./shopping-cart.html"><img src="img/icon/cart.png" alt=""> <span>0</span></a>
                    <div class="price"  id="cart-price">$0.00</div>
                </div>
            </div>
        </div>
        <div class="canvas__open"><i class="fa fa-bars"></i></div>
    </div>
    </header>
    <!-- Header Section End -->

    <!-- Shop Details Section Begin -->
    <section class="shop-details">
        <div class="product__details__pic">
            <div class="container">
                <div class="row">
                    <div class="col-lg-12">
                        <div class="product__details__breadcrumb">
                            <a href="./index.html">Home</a>
                            <a href="./shop.html">Shop</a>
                            <span>Product Details</span>
                        </div>
                    </div>
                </div>
                <div class="row" style="display: flex; justify-content: space-around; align-items: center;">

                    <div class="col-lg-6 col-md-9">
                        <div class="tab-content">
                            <div class="tab-pane active" id="tabs-1" role="tabpanel">
                                <div class="product__details__pic__item">
                                    <img src="" alt="" id="photo">
                                    <p hidden id="productId"></p>
                                </div>
                            </div>

                        </div>

                    </div>
                    <div class="row d-flex justify-content-center">
                        <div class="col-lg-8">
                            <div class="product__details__text">
                                <h4 id="name">Hooded thermal anorak</h4>
                                <div class="rating">
                                    <i class="fa fa-star"></i>
                                    <i class="fa fa-star"></i>
                                    <i class="fa fa-star"></i>
                                    <i class="fa fa-star"></i>
                                    <i class="fa fa-star-o"></i>
                                    <span> - 5 Reviews</span>
                                </div>
                                <h3 id="price">$270.00 </h3>
                                <div class="product__details__cart__option">
                                    <div class="quantity">
                                        <div class="pro-qty">
                                            <input type="text" id ="quantity" value="1">
                                        </div>
                                    </div>
                                    <a href="#" class="primary-btn" id="add-to-cart">add to cart</a>
                                    <p id="message" style="color: rgb(72, 145, 72); margin-top: 2px; font-size: 20px;"></p>
                                </div>

                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="product__details__content">
            <div class="container">
                <div class="row">
                    <div class="col-lg-12">
                        <div class="product__details__tab">
                            <ul class="nav nav-tabs" role="tablist">
                                <li class="nav-item">
                                    <a class="nav-link active" data-toggle="tab" href="#tabs-5"
                                        role="tab">Description</a>
                                </li>

                            </ul>
                            <div class="tab-content">
                                <div class="tab-pane active" id="tabs-5" role="tabpanel">
                                    <div class="product__details__tab__content">

                                        <div class="product__details__tab__content__item">
                                            <h5>Products Infomation</h5>
                                            <p id="description">A Pocket PC is a handheld computer, which features many of the same
                                                capabilities as a modern PC. These handy little devices allow
                                                individuals to retrieve and store e-mail messages, create a contact
                                                file, coordinate appointments, surf the internet, exchange text messages
                                                and more. Every product that is labeled as a Pocket PC must be
                                                accompanied with specific software to operate the unit and must feature
                                                a touchscreen and touchpad.</p>
                                           <br>
                                           <br>
                                        </div>

                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!-- Shop Details Section End -->



    <!-- Footer Section Begin -->
    <footer class="footer">
        <div class="container">
            <div class="row">
                <div class="col-lg-3 col-md-6 col-sm-6">
                    <div class="footer__about">
                        <p>The customer is at the heart of our unique business model, which includes design.</p>
                    </div>
                </div>

            </div>

        </div>
    </footer>
    <!-- Footer Section End -->

    <!-- Search Begin -->
    <div class="search-model">
        <div class="h-100 d-flex align-items-center justify-content-center">
            <div class="search-close-switch">+</div>
            <form class="search-model-form">
                <input type="text" id="search-input" placeholder="Search here.....">
            </form>
        </div>
    </div>
    <!-- Search End -->

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            fetchProduct();
        });

        function fetchProduct() {
            // Make a fetch GET request
            const urlParams = new URLSearchParams(window.location.search);
            const productId = urlParams.get('id');
            if (!productId) {
                window.location.replace('./shop.html');
            }
            fetch('http://localhost:9000/api/product/' + productId, {
                method: 'GET'
            })
                .then(response => response.json())
                .then(data => {
                    document.getElementById("name").innerText = data.name;
                    document.getElementById("price").innerText = data.price;
                    document.getElementById("description").innerText = data.description;
                    document.getElementById('productId').innerText = productId;
                    fetchImage(`http://localhost:9000/api/product/photo/${productId}`, "photo");
                })
                .catch(error => console.error('Error fetching data:', error));
        }

        async function fetchImage(url, id) {
            try {
                const response = await fetch(url);
                if (!response.ok) {
                    throw new Error('Failed to fetch image');
                }

                const blob = await response.blob();
                const reader = new FileReader();

                reader.onload = function() {
                    const imageUrl = reader.result;
                    document.getElementById(id).setAttribute('src', `${imageUrl}`);
                };

                reader.readAsDataURL(blob);
            } catch (error) {
                console.error(error);
            }}
            
        
        
        const addToCart = () => {
            const userId = localStorage.getItem('userId');
            const token = localStorage.getItem('token');
            const productId = document.getElementById('productId').innerText;
            const quantity = document.getElementById('quantity').value;
            if (parseInt(quantity) <= 0) {
                alert('Please enter a valid quantity');
                return;
            }
            const data = {}
            data["products"] = {};
            data["products"][productId] = {quantity};
            data["user"] = userId;
            fetch(`http://localhost:9000/api/cart/add/${userId}/${token}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            })
                .then(response => {
                    if (!response.ok) {
                        alert('Please create an account or login to add to cart');
                        window.location.href = './login.html';
                        throw new Error('Failed to add to cart');
                    }
                    return response.json();
                
                })
                .then(data => {
                    let price = document.getElementById("price").innerText
                    price = price.replace('$', '');
                    const prev_total = localStorage.getItem('total_price');
                    localStorage.setItem('total_price', parseFloat(prev_total) + (parseFloat(price)*parseInt(quantity)));
                    document.getElementById('cart-price').innerText = `$${(+localStorage.getItem('total_price')).toFixed(2)}`;
                    showMessage('message', 'Added to cart', 3000);
                })
                .catch(error => console.error('Error adding to cart:', error));
        };

        const addToCartButton = document.getElementById('add-to-cart');
        addToCartButton.addEventListener('click', addToCart);


        
    </script>

    <!-- Js Plugins -->
    <script src="js/jquery-3.3.1.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/jquery.nice-select.min.js"></script>
    <script src="js/jquery.nicescroll.min.js"></script>
    <script src="js/jquery.magnific-popup.min.js"></script>
    <script src="js/jquery.countdown.min.js"></script>
    <script src="js/jquery.slicknav.js"></script>
    <script src="js/mixitup.min.js"></script>
    <script src="js/owl.carousel.min.js"></script>
    <script src="js/main.js"></script>
    <script src="js/cart.js"></script>
</body>

</html>